<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ポケモンタイムアタック</title>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 10px;
  background: #f5f5f5;
}

.container {
  max-width: 500px;
  margin: auto;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
  font-size: 1.4em;
}

select, input, button {
  width: 100%;
  font-size: 1.1em;
  padding: 10px;
  margin: 8px 0;
}

#status {
  text-align: center;
  font-size: 1.2em;
  margin: 10px 0;
}

#timer {
  font-weight: bold;
  color: red;
}

.hidden {
  display: none;
}
</style>
</head>

<body>
<div class="container">
  <h1>ポケモンタイムアタック</h1>

  <label>制限時間（秒）</label>
  <select id="timeSelect">
    <option value="1">1秒</option>
    <option value="2">2秒</option>
    <option value="3">3秒</option>
    <option value="4">4秒</option>
    <option value="5" selected>5秒</option>
    <option value="6">6秒</option>
    <option value="7">7秒</option>
    <option value="8">8秒</option>
    <option value="9">9秒</option>
    <option value="10">10秒</option>
  </select>

  <button onclick="startGame()">ゲーム開始</button>

  <div id="game" class="hidden">
    <div id="status">
      No.<span id="number"></span><br>
      ⏱ <span id="timer"></span>s<br>
      正解数：<span id="score">0</span><br>
      最高記録：<span id="best">0</span>
    </div>

    <input id="answer" list="pokemonList" placeholder="ポケモン名を入力" autocomplete="off">
    <datalist id="pokemonList"></datalist>
  </div>
</div>

<script>
let pokemon = {};
let numbers = [];
let currentNumber = null;
let timer = null;
let timeLeft = 0;
let limit = 5;
let score = 0;
let best = localStorage.getItem("pokemon_best") || 0;

document.getElementById("best").textContent = best;

/* ===== JSON読み込み ===== */
fetch("pokemon.json")
  .then(r => r.json())
  .then(data => {
    pokemon = data;
    numbers = Object.keys(pokemon);
    const list = document.getElementById("pokemonList");
    numbers.forEach(n => {
      const o = document.createElement("option");
      o.value = pokemon[n];
      list.appendChild(o);
    });
  })
  .catch(() => alert("pokemon.json の読み込みに失敗しました"));

/* ===== ゲーム開始 ===== */
function startGame() {
  score = 0;
  limit = Number(document.getElementById("timeSelect").value);
  document.getElementById("score").textContent = score;
  document.getElementById("game").classList.remove("hidden");
  nextQuestion();
}

/* ===== 次の問題 ===== */
function nextQuestion() {
  clearInterval(timer);
  timeLeft = limit;
  document.getElementById("timer").textContent = timeLeft;

  currentNumber = numbers[Math.floor(Math.random() * numbers.length)];
  document.getElementById("number").textContent = currentNumber;

  const input = document.getElementById("answer");
  input.value = "";
  input.focus();

  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if (timeLeft <= 0) gameOver("時間切れ！");
  }, 1000);
}

/* ===== 判定 ===== */
document.getElementById("answer").addEventListener("keydown", e => {
  if (e.key === "Enter") checkAnswer();
});

function checkAnswer() {
  const input = document.getElementById("answer").value.trim();
  if (input === pokemon[currentNumber]) {
    score++;
    document.getElementById("score").textContent = score;
    nextQuestion();
  } else {
    gameOver("不正解！");
  }
}

/* ===== ゲームオーバー ===== */
function gameOver(reason) {
  clearInterval(timer);

  if (score > best) {
    best = score;
    localStorage.setItem("pokemon_best", best);
  }

  alert(`${reason}\nスコア：${score}\n最高記録：${best}`);
  document.getElementById("best").textContent = best;
  document.getElementById("game").classList.add("hidden");
}
</script>
</body>
</html>